<!doctype html>
<html lang="en">
   <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>Hunter × Hunter: Nen Trials</title>
      <link rel="stylesheet" href="styles.css" />
      <!-- Babylon.js (core + GUI + materials library for grid) -->
      <script src="https://cdn.babylonjs.com/babylon.js"></script>
      <script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>
      <script src="https://cdn.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
      <script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
   </head>
   <body>
      <!-- ========== MENU ========== -->
      <div id="screen--menu" class="screen visible">
         <!-- Background animation -->
         <div class="menu-bg">
            <canvas id="menu-canvas"></canvas>
         </div>
         <!-- Foreground UI -->
         <div class="menu-contents">
            <h1>Hunter × Hunter: Nen Trials</h1>
            <p class="lead">Create your hunter, choose your Nen type, and fight on a 3D platformer arena.</p>
            <div class="btn-row">
               <button id="btn-resume" class="primary" hidden>Resume</button>
               <button id="btn-new" class="success">New Game</button>
               <button id="btn-settings" class="secondary">Settings</button>
               <button id="btn-rig" class="secondary">Rig Editor (limbs &amp; offsets)</button>
            </div>
            <details class="small">
               <summary>Controls</summary>
               <p>WASD to move, Space to jump (hold to charge), Mouse Right-drag to orbit, Q / E abilities, Shift to dash.</p>
            </details>
         </div>
      </div>
      <!-- ========== SETTINGS ========== -->
      <div id="screen--settings" class="screen">
         <div class="panel panel-wide">
            <h2>Terrain &amp; Performance Settings</h2>
            <form id="settings-form" class="settings-form">
               <div class="grid-2">
                  <label>Terrain Length (cubes)
                  <input type="number" id="settings-length" min="8" max="256" step="1" required />
                  </label>
                  <label>Terrain Width (cubes)
                  <input type="number" id="settings-width" min="8" max="256" step="1" required />
                  </label>
               </div>
               <div class="grid-2">
                  <label>Cube Size (world units)
                  <input type="number" id="settings-cube" min="0.5" max="4" step="0.1" required />
                  </label>
                  <label>Active Radius (lag reduction)
                  <input type="number" id="settings-radius" min="6" max="200" step="1" required />
                  </label>
               </div>
               <label>Max Trees (performance cap)
               <input type="number" id="settings-max-trees" min="0" max="400" step="1" required />
               </label>
               <p class="small muted">Only cubes within the active radius are visible and collidable. Increase the radius for longer draw distances at the cost of performance.</p>
               <div class="row-right">
                  <button type="button" id="settings-cancel" class="secondary">Cancel</button>
                  <button type="submit" class="primary">Save</button>
               </div>
            </form>
         </div>
      </div>
      <!-- ========== CHARACTER CREATOR ========== -->
      <div id="screen--creator" class="screen">
         <div class="panel panel-wide">
            <h2>Character Creator</h2>
            <form id="creator-form">
               <div class="grid-2">
                  <label>Hunter Name
                  <input required type="text" id="cc-name" maxlength="24" placeholder="Gon, Killua, You..." />
                  </label>
                  <label>Clan / Origin
                  <input type="text" id="cc-clan" maxlength="24" placeholder="Whale Island, Phantom..." />
                  </label>
               </div>
               <label>
                  Nen Type
                  <select id="cc-nen">
                     <option>Enhancer</option>
                     <option>Emitter</option>
                     <option>Transmuter</option>
                     <option>Conjurer</option>
                     <option>Manipulator</option>
                     <option>Specialist</option>
                  </select>
               </label>
               <label> Theme Color
               <input type="color" id="cc-color" value="#00ffcc" />
               </label>
               <fieldset>
                  <legend>Distribute 10 Stat Points</legend>
                  <div class="grid-3">
                     <label>Power <input type="number" id="cc-power" min="0" max="10" value="4"></label>
                     <label>Agility <input type="number" id="cc-agility" min="0" max="10" value="3"></label>
                     <label>Focus <input type="number" id="cc-focus" min="0" max="10" value="3"></label>
                  </div>
                  <p class="small">Power = melee damage; Agility = move speed &amp; dash; Focus = nen damage &amp; cooldowns.</p>
                  <p id="points-remaining">Points remaining: <b>0</b></p>
               </fieldset>
               <div class="row-right">
                  <button type="button" id="btn-cancel" class="secondary">Cancel</button>
                  <button type="submit" class="primary">Save</button>
               </div>
            </form>
         </div>
      </div>
      <!-- ========== GAME ========== -->
      <div id="screen--game" class="screen">
         <canvas id="game-canvas" tabindex="0"></canvas>
         <!-- HUD -->
         <div id="hud">
            <div class="hud-left">
               <div id="hud-name"></div>
               <div id="hud-nen"></div>
               <div id="hud-level"></div>
            </div>
            <div class="hud-right">
               <div class="bar small" id="hud-xpbar"><span></span></div>
               <div id="hud-health" class="bar"><span></span></div>
               <div id="hud-nenbar" class="bar alt"><span></span></div>
            </div>
            <div id="hud-bottom">
               <div id="hud-message"></div>
               <div id="cooldowns">
                  <div class="cd" id="cd-q">Q</div>
                  <div class="cd" id="cd-e">E</div>
                  <div class="cd" id="cd-shift">Dash</div>
               </div>
            </div>
         </div>
         <!-- Mobile controls (shown on touch devices) -->
         <div id="mobile-controls">
            <div id="mobile-joystick" aria-label="Move">
               <div id="mobile-joystick-thumb"></div>
            </div>
            <div class="mobile-buttons" aria-label="Touch controls">
               <div class="mobile-btn-row">
                  <button id="mc-blast" class="mobile-btn small" aria-label="Nen Blast">Blast</button>
                  <button id="mc-special" class="mobile-btn small" aria-label="Special Ability">Special</button>
               </div>
               <div class="mobile-btn-row">
                  <button id="mc-dash" class="mobile-btn" aria-label="Dash">Dash</button>
                  <button id="mc-jump" class="mobile-btn" aria-label="Jump">Jump</button>
               </div>
               <div class="mobile-btn-row">
                  <button id="mc-nen" class="mobile-btn small" aria-label="Charge Nen">Charge</button>
                  <button id="mc-attack" class="mobile-btn primary" aria-label="Attack">Attack</button>
               </div>
            </div>
         </div>
         <!-- Pause -->
         <div id="pause-overlay" class="overlay">
            <div class="panel">
               <h2>Paused</h2>
               <button id="btn-resume-pause" class="success">Resume</button>
               <button id="btn-exit" class="secondary">Exit to Menu</button>
            </div>
         </div>
         <!-- Level Up -->
         <div id="level-overlay" class="overlay">
            <div class="panel panel-wide">
               <h2>Level Up</h2>
               <p>Level: <b id="lv-cur"></b> &nbsp; | &nbsp; Unspent Points: <b id="lv-unspent"></b></p>
               <div class="grid-2">
                  <div>
                     <h3>Allocate Points</h3>
                     <div class="stat-row">Power <button data-stat="power" class="plus">+</button> <span id="s-power">0</span></div>
                     <div class="stat-row">Agility <button data-stat="agility" class="plus">+</button> <span id="s-agility">0</span></div>
                     <div class="stat-row">Focus <button data-stat="focus" class="plus">+</button> <span id="s-focus">0</span></div>
                  </div>
                  <div>
                     <h3>Effects</h3>
                     <ul class="small">
                        <li><b>Power</b>: +Max HP, +Melee Damage, +small HP regen</li>
                        <li><b>Agility</b>: +Move speed, +Dash power, ↓Dash cooldown, +jump</li>
                        <li><b>Focus</b>: +Max Nen, +Nen regen, ↑Nen damage, ↓ability cooldowns</li>
                     </ul>
                  </div>
               </div>
               <div class="row-right">
                  <button id="lv-close" class="secondary">Close</button>
               </div>
            </div>
         </div>
      </div>
      <!-- ========== RIG EDITOR (TOP-LEVEL SIBLING) ========== -->
      <div id="screen--rig" class="screen">
         <div class="rig-layout">
            <div class="rig-canvas-wrap">
               <canvas id="rig-canvas"></canvas>
               <div class="rig-help">Left-drag to orbit • Right-drag to pan • Wheel to zoom</div>
            </div>
            <div class="rig-panel panel">
               <h2>Humanoid Rig Editor</h2>
               <div id="rig-form" class="rig-form"></div>
               <div class="row-right rig-actions">
                  <button id="rig-reset" class="secondary">Reset</button>
                  <button id="rig-save-local" class="secondary">Save to Browser</button>
                  <button id="rig-export" class="primary">Export XML</button>
                  <button id="rig-exit" class="success">Back</button>
               </div>
            </div>
         </div>
      </div>
      <!-- Scripts (load after markup so handlers can bind safely) -->
	  <script src="game.js" defer></script>
	  <script src="character.js" defer></script>
	  <script src="rig-editor.js" defer></script>
	  <script src="menu-bg.js" defer></script>

   </body>
</html>